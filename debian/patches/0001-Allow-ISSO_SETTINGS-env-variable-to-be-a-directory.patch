From: Federico Ceratto <federico.ceratto@gmail.com>
Date: Sun, 15 Jun 2014 22:49:50 +0100
Subject: Allow ISSO_SETTINGS env variable to be a directory

---
 isso/dispatch.py | 26 +++++++++++++++++---------
 1 file changed, 17 insertions(+), 9 deletions(-)

diff --git a/isso/dispatch.py b/isso/dispatch.py
index 14441e2..6cd3974 100644
--- a/isso/dispatch.py
+++ b/isso/dispatch.py
@@ -1,8 +1,11 @@
 # -*- encoding: utf-8 -*-
 
+import sys
 import os
 import logging
 
+from glob import glob
+
 from werkzeug.wsgi import DispatcherMiddleware
 from werkzeug.wrappers import Response
 
@@ -44,13 +47,18 @@ class Dispatcher(DispatcherMiddleware):
         return resp(environ, start_response)
 
 
-if "ISSO_SETTINGS" not in os.environ:
-    logger.fatal('no such environment variable: ISSO_SETTINGS')
-else:
-    confs = os.environ["ISSO_SETTINGS"].split(";")
-    for path in confs:
-        if not os.path.isfile(path):
-            logger.fatal("%s: no such file", path)
-            break
-    else:
+settings = os.environ.get("ISSO_SETTINGS")
+if settings:
+    if os.path.isdir(settings):
+        conf_glob = os.path.join(settings, '*.cfg')
+        confs = glob(conf_glob)
         application = wsgi.SubURI(Dispatcher(*confs))
+    else:
+        confs = settings.split(";")
+        for path in confs:
+            if not os.path.isfile(path):
+                logger.fatal("%s: no such file", path)
+                sys.exit(1)
+    application = wsgi.SubURI(Dispatcher(*confs))
+else:
+    logger.fatal('environment variable ISSO_SETTINGS must be set')
