(function() {
    var head = document.getElementsByTagName("head")[0];
    var js = document.getElementsByTagName("script");

    var isso = null,
        args = [];
    for (var i = 0; i < js.length; i++) {
        for (var j = 0; j < js[i].attributes.length; j++) {
            var attr = js[i].attributes[j];
            if (attr.name == "data-isso") {
                isso = attr.value;
            } else if (/^data-isso-/.test(attr.name)) {
                args.push(attr);
            }
        }
    }

    if (isso === null) {
        console.log("Error: embed.min.js stub requires `data-isso`")
        return;
    }

    if (isso[isso.length - 1] === "/") {
        isso = isso.substring(0, isso.length - 1);
    }

    var config = document.createElement("script");
    config.src = isso + "/js/config.js"

    var embed = document.createElement("script");
    embed.src = isso + "/js/components/requirejs/require.js"

    embed.setAttribute("data-main", isso + "/js/embed")
    embed.setAttribute("data-isso", isso)

    for (var i = 0; i < args.length; i++) {
        embed.setAttribute(args[i].name, args[i].value);
    }

    head.appendChild(config);
    head.appendChild(embed);
}());
